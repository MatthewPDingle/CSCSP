SELECT (SELECT (b2.adjclose - b1.adjclose) / b1.adjclose * 100 FROM basicr b1 INNER JOIN basicr b2 ON b1.symbol = b2.symbol AND b2.date = (SELECT q.date FROM (SELECT r.date, r.adjclose, m.value FROM basicr r INNER JOIN metric_consecutiveupdays m ON r.symbol = m.symbol AND r.date = m.date WHERE r.date > b.date AND r.symbol = b.symbol AND m.value >= 2.0 ORDER BY r.date LIMIT 1 ) q ORDER BY date DESC LIMIT 1) WHERE b1.symbol = 'SPY' AND b1.date = b.date) AS metricsp500perchange, COALESCE((((SELECT q.adjclose FROM (SELECT r.date, r.adjclose, m.value FROM basicr r INNER JOIN metric_consecutiveupdays m ON r.symbol = m.symbol AND r.date = m.date WHERE r.date > b.date AND r.symbol = b.symbol AND m.value >= 2.0 ORDER BY r.date LIMIT 1 ) q ORDER BY date DESC LIMIT 1) - b.adjclose) / b.adjclose * 100), (((SELECT q.adjclose FROM (SELECT date, adjclose FROM basicr WHERE date > b.date AND symbol = b.symbol ORDER BY date DESC LIMIT 1 ) q ORDER BY date DESC LIMIT 1) - b.adjclose) / b.adjclose * 100)) AS perchange, countbusinessdays(b.date, (SELECT r.date FROM basicr r INNER JOIN metric_consecutiveupdays m ON r.symbol = m.symbol AND r.date = m.date WHERE r.date > b.date AND r.symbol = b.symbol AND m.value >= 2.0 ORDER BY r.date LIMIT 1)) AS positionlength, countbusinessdays(b.date, (SELECT date FROM basicr WHERE date > b.date AND symbol = b.symbol ORDER BY date DESC LIMIT 1 )) AS latestdatepositionlength, (SELECT (b2.adjclose - b1.adjclose) / b1.adjclose * 100 FROM basicr b1 INNER JOIN basicr b2 ON b1.symbol = b2.symbol AND b2.date = (SELECT q.date FROM (SELECT date FROM basicr WHERE date > b.date AND symbol = b.symbol ORDER BY date DESC LIMIT 1) q ORDER BY date DESC LIMIT 1) WHERE b1.symbol = 'SPY' AND b1.date = b.date) AS endsp500perchange, NULL AS stopexitperchange, 0 AS stopexitpositionlength, NULL AS stopsp500perchange FROM basicr b INNER JOIN metric_dv2 y ON b.symbol = y.symbol AND b.date = y.date INNER JOIN metric_rsi2 x ON b.symbol = x.symbol AND b.date = x.date INNER JOIN metric_priceboll20 psd ON b.symbol = psd.symbol AND b.date = psd.date WHERE b.symbol IN (SELECT DISTINCT symbol FROM indexlist WHERE index = 'NYSE' OR index = 'Nasdaq' OR index = 'DJIA' OR index = 'SP500' ) AND b.date >= '2015-05-05' AND b.date < '2015-07-05' AND b.date < '2015-07-03' AND x.value >= 0.0 AND x.value <= 5.0 AND y.value >= -5.4 AND y.value <= -4.8 AND b.volume >= 2000000 / b.adjclose AND ABS(psd.value) <= 1.0 AND b.adjclose >= 3.0 
